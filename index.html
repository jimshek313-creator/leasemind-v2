<!doctype html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LeaseMind V2 Demo | AI Rental Decision Layer</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --text:#111827; --muted:#6b7280;
      --line:#e5e7eb; --blue:#2563eb; --green:#16a34a; --amber:#f59e0b;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg); color:var(--text);}
    .wrap{max-width:1180px; margin:18px auto; padding:0 14px;}
    .topbar{display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:12px;}
    .brand{font-weight:800; font-size:18px;}
    .sub{color:var(--muted); font-size:12px; margin-top:4px;}
    .mode{font-size:12px; color:var(--muted);}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:14px;}
    .card{background:var(--card); border:1px solid var(--line); border-radius:14px; box-shadow:0 2px 10px rgba(0,0,0,.04);}
    .card-h{padding:12px 14px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center;}
    .card-b{padding:14px;}
    .pill{display:inline-flex; align-items:center; gap:6px; border:1px solid var(--line);
      border-radius:999px; padding:6px 10px; font-size:12px; color:var(--muted); background:#fafafa;}
    .pill b{color:var(--text)}
    .chat{height:420px; overflow:auto; padding:6px 2px;}
    .msg{max-width:92%; padding:10px 12px; border-radius:12px; margin:8px 0; white-space:pre-wrap; line-height:1.35;}
    .assistant{background:#f3f4f6; border:1px solid #eef2f7;}
    .user{background:#eff6ff; border:1px solid #dbeafe; margin-left:auto;}
    .hint{color:var(--muted); font-size:12px; margin:0 0 10px 0;}
    .row{display:flex; gap:10px; margin-top:10px;}
    input[type="text"]{flex:1; padding:12px 12px; border-radius:12px; border:1px solid var(--line); outline:none;}
    button{padding:12px 14px; border-radius:12px; border:1px solid var(--line); background:#fff; cursor:pointer; font-weight:700;}
    button:hover{border-color:#cbd5e1}
    button.primary{background:var(--blue); color:#fff; border-color:var(--blue);}
    button.primary:hover{filter:brightness(.98)}
    button.ghost{background:#fff;}
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;}
    .chip{font-size:12px; border:1px solid var(--line); background:#fff; border-radius:999px; padding:8px 10px; cursor:pointer;}
    .chip:hover{border-color:#cbd5e1}
    .actions{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;}
    .actions button{flex:1; min-width:160px;}
    .note{font-size:12px; color:var(--muted); margin-top:10px; line-height:1.35;}
    .kpi{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;}
    .kpi .box{border:1px solid var(--line); border-radius:12px; padding:10px 12px; background:#fff;}
    .kpi .box .t{font-size:12px; color:var(--muted);}
    .kpi .box .v{font-size:16px; font-weight:800; margin-top:3px;}
    .lead{border:1px dashed #cbd5e1; border-radius:12px; padding:10px 12px; background:#fafafa; margin-top:10px;}
    .lead b{display:block; margin-bottom:6px;}
    .small{font-size:12px; color:var(--muted);}
    .ok{color:var(--green); font-weight:700;}
    .warn{color:#b45309; font-weight:700;}
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
      .chat{height:380px;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <div class="brand">LeaseMind <span class="pill"><b>V2</b> Demo</span></div>
        <div class="sub">AI Rental Decision Layer · 本地模拟（不依赖 API）· 用于展示“决策→行动”闭环</div>
      </div>
      <div class="mode">Mode: <b>Demo（中文）</b> · Max Clarifying Qs: <b>≤3</b></div>
    </div>

    <div class="grid">
      <!-- LEFT: Chat -->
      <div class="card">
        <div class="card-h">
          <div><b>Live Demo Chat</b> <span class="pill">Local AI Simulator</span></div>
          <div class="pill">Status: <b id="status">Ready</b></div>
        </div>
        <div class="card-b">
          <p class="hint">输入需求 → AI 补问 ≤3 次 → 输出结构化建议 → 点击 <b>预约看房</b> / <b>留下联系方式</b> 完成闭环。</p>

          <div id="chat" class="chat"></div>

          <div class="chips">
            <div class="chip" data-fill="我想在 Monash Clayton 附近找单人间，预算 280–320 澳币/周，下周入住">试试：单人间 280–320/周 下周入住</div>
            <div class="chip" data-fill="我更倾向独立卫浴（Ensuite），走路 10 分钟内到 Monash Clayton，预算 320–380/周">试试：Ensuite 10 分钟内 320–380/周</div>
            <div class="chip" data-fill="我想先预约 open inspection，本周六下午有空">试试：预约 open inspection</div>
            <div class="chip" data-fill="我想留下联系方式，让顾问联系我">试试：留下联系方式</div>
          </div>

          <div class="row">
            <input id="inp" type="text" placeholder="例如：我想在 Monash Clayton 附近找单人间，预算 280–320/周，下周入住…" />
            <button id="btnSend" class="primary">发送</button>
          </div>

          <div class="actions">
            <button id="btn-inspect" class="ghost">预约看房（Demo）</button>
            <button id="btn-contact" class="ghost">留下联系方式（Demo）</button>
          </div>

          <div id="leadBox" class="lead" style="display:none;"></div>

          <div class="note">
            说明：此版本用于展示交互逻辑与文案表达，后续可无缝替换为真实 LLM（OpenAI）与房源数据库 / CRM 工作流。<br/>
            <span class="warn">本地模拟不会生成任何“虚构房源事实”</span>：若缺信息会先补问或提示转人工。
          </div>
        </div>
      </div>

      <!-- RIGHT: Investor panel -->
      <div class="card">
        <div class="card-h"><b>Investor View</b> <span class="pill">1-page narrative</span></div>
        <div class="card-b">
          <h3 style="margin:0 0 8px 0;">What does LeaseMind do?</h3>
          <div class="small">
            LeaseMind sits <b>before listings and agents</b>, turning messy rental questions into <b>structured decisions</b> and <b>next actions</b>.
          </div>

          <h3 style="margin:14px 0 8px 0;">The problem we solve</h3>
          <ul class="small" style="margin:0; padding-left:18px; line-height:1.5;">
            <li><b>Information overload</b>: users can’t compare options rationally</li>
            <li><b>High friction</b>: repeated Q&A wastes consultant time</li>
            <li><b>No decision layer</b>:咨询缺少标准化“收敛到行动”</li>
          </ul>

          <h3 style="margin:14px 0 8px 0;">What this demo validates</h3>
          <ul class="small" style="margin:0; padding-left:18px; line-height:1.5;">
            <li>意图识别：预算 / 房型 / 距离 / 入住时间</li>
            <li>最小补问：≤3 个澄清问题</li>
            <li>行动引导：预约看房、留资、转人工</li>
          </ul>

          <div class="kpi">
            <div class="box">
              <div class="t">V2</div>
              <div class="v">Local Simulator</div>
            </div>
            <div class="box">
              <div class="t">Max Clarifying</div>
              <div class="v">≤ 3</div>
            </div>
          </div>

          <h3 style="margin:14px 0 8px 0;">Next phase</h3>
          <ul class="small" style="margin:0; padding-left:18px; line-height:1.5;">
            <li>Replace simulator with real LLM + guardrails</li>
            <li>Live property database integration</li>
            <li>Inspection scheduling automation</li>
            <li>CRM workflow for agents/operators</li>
          </ul>

          <div class="small" style="margin-top:12px;">LeaseMind © 2026 · For discussion and evaluation</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -----------------------
    // Chat helpers
    // -----------------------
    const chat = document.getElementById("chat");
    const inp  = document.getElementById("inp");
    const btn  = document.getElementById("btnSend");
    const statusEl = document.getElementById("status");

    const leadBox = document.getElementById("leadBox");
    const inspectBtn = document.getElementById("btn-inspect");
    const contactBtn = document.getElementById("btn-contact");

    function add(role, text){
      const div = document.createElement("div");
      div.className = "msg " + (role === "user" ? "user" : "assistant");
      div.innerText = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    function setStatus(s){ statusEl.innerText = s; }

    // -----------------------
    // Minimal "decision layer" state
    // -----------------------
    const state = {
      intent: "rental",
      constraints: {
        location: "Monash Clayton 周边",
        roomType: null,      // Single / Ensuite
        budgetMin: null,
        budgetMax: null,
        moveIn: null,        // e.g., 下周 / 本周六
        walkTime: null       // e.g., 10 分钟内
      },
      clarifyingAsked: 0,
      lead: {
        created: false,
        contact: null,
        inspection: null
      }
    };

    // -----------------------
    // Tiny parser (conservative)
    // -----------------------
    function parseInput(text){
      const t = text.toLowerCase();

      // room type
      if (t.includes("ensuite") || text.includes("独立卫浴") || text.includes("套房")) state.constraints.roomType = "Ensuite（独立卫浴）";
      if (t.includes("single") || text.includes("单人间") || text.includes("单人房")) state.constraints.roomType = "Single（单人间）";

      // budget (supports 280-320, 280–320, $280-$320)
      const m = text.match(/(\d{2,4})\s*[–\-~到]\s*(\d{2,4})/);
      if (m){
        state.constraints.budgetMin = parseInt(m[1],10);
        state.constraints.budgetMax = parseInt(m[2],10);
      } else {
        // single number like "300/周"
        const s = text.match(/(\d{2,4})\s*(澳币|aud|\$)?\s*\/?\s*周/);
        if (s){
          const v = parseInt(s[1],10);
          state.constraints.budgetMin = v;
          state.constraints.budgetMax = v;
        }
      }

      // move-in
      if (text.includes("下周")) state.constraints.moveIn = "下周";
      if (text.includes("本周") || text.includes("这周")) state.constraints.moveIn = "本周";
      if (text.includes("周六")) state.constraints.moveIn = "周六";
      if (text.includes("周日")) state.constraints.moveIn = "周日";

      // walk time
      const wt = text.match(/(\d{1,2})\s*分钟/);
      if (wt) state.constraints.walkTime = wt[1] + " 分钟内";

      // intent shortcuts
      if (text.includes("预约") || text.toLowerCase().includes("inspection")) state.intent = "inspection";
      if (text.includes("联系方式") || text.includes("留资") || text.includes("联系我")) state.intent = "contact";
    }

    function missingFields(){
      const c = state.constraints;
      const miss = [];
      if (!c.roomType) miss.push("房型（Single / Ensuite）");
      if (!c.budgetMin) miss.push("预算（每周 AUD 区间）");
      if (!c.moveIn) miss.push("入住时间（例如：下周/本周六）");
      return miss;
    }

    function summaryBlock(){
      const c = state.constraints;
      const b = (c.budgetMin && c.budgetMax) ? `$${c.budgetMin}–$${c.budgetMax}/周` : "未提供";
      return [
        "好的，我先把已知信息整理成「可决策」格式：",
        `位置：${c.location}`,
        `房型：${c.roomType || "未确认"}`,
        `预算：${b}`,
        `入住：${c.moveIn || "未确认"}`,
        c.walkTime ? `通勤：步行 ${c.walkTime} 到 Monash Clayton` : ""
      ].filter(Boolean).join("\n");
    }

    function askClarifying(){
      const miss = missingFields();
      const q = miss.slice(0, 3).map(x => `• 你希望的${x}是？`).join("\n");
      state.clarifyingAsked += 1;
      return `为了避免我猜测导致错误，我需要补充最多 3 个关键信息：\n${q}`;
    }

    function recommendNext(){
      // No fabricated listing facts. Provide action-oriented options.
      const c = state.constraints;
      const b = (c.budgetMin && c.budgetMax) ? `$${c.budgetMin}–$${c.budgetMax}/周` : "预算待确认";
      const rt = c.roomType || "房型待确认";
      const mv = c.moveIn || "入住时间待确认";

      return [
        "太好了，你的信息已足够进入「推荐/看房」阶段。",
        "",
        "下一步建议（Demo）：",
        "• 点击「预约看房」：安排 Open Inspection 或私约时间",
        "• 或点击「留下联系方式」：我将把需求整理成线索，交给顾问跟进",
        "",
        "你当前偏好（将用于线索摘要）：",
        `• ${rt} · ${b} · ${mv} · ${c.location}${c.walkTime ? " · 步行"+c.walkTime : ""}`
      ].join("\n");
    }

    function routeIntent(){
      if (state.intent === "inspection"){
        add("assistant", "收到，你想预约看房。请点击下方「预约看房（Demo）」我会生成预约请求。");
        return;
      }
      if (state.intent === "contact"){
        add("assistant", "收到，你想留下联系方式。请点击下方「留下联系方式（Demo）」我会生成线索并记录联系人。");
        return;
      }
    }

    // -----------------------
    // Lead generator (front-end only)
    // -----------------------
    function renderLead(){
      const c = state.constraints;
      const b = (c.budgetMin && c.budgetMax) ? `$${c.budgetMin}–$${c.budgetMax}/周` : "未提供";
      const lead = {
        location: c.location,
        roomType: c.roomType || "未确认",
        budget: b,
        moveIn: c.moveIn || "未确认",
        walk: c.walkTime || "未指定",
        contact: state.lead.contact || "未留下",
        inspection: state.lead.inspection || "未预约"
      };

      leadBox.style.display = "block";
      leadBox.innerHTML = `
        <b>✅ Lead Summary（Demo 生成）</b>
        <div class="small">
          位置：${lead.location}<br/>
          房型：${lead.roomType}<br/>
          预算：${lead.budget}<br/>
          入住：${lead.moveIn}<br/>
          通勤：${lead.walk}<br/>
          联系方式：<span class="${state.lead.contact ? "ok" : ""}">${lead.contact}</span><br/>
          看房预约：<span class="${state.lead.inspection ? "ok" : ""}">${lead.inspection}</span>
        </div>
      `;
    }

    // -----------------------
    // Main send
    // -----------------------
    async function send(){
      const text = inp.value.trim();
      if(!text) return;
      setStatus("Thinking…");
      add("user", text);
      inp.value = "";

      parseInput(text);

      // If user directly expresses intent, route it
      routeIntent();

      // Provide summary
      add("assistant", summaryBlock());

      // Ask clarifying if needed (≤3 questions total as a principle)
      const miss = missingFields();
      if (miss.length > 0){
        add("assistant", askClarifying());
        setStatus("Waiting");
        return;
      }

      // Otherwise recommend next
      add("assistant", recommendNext());
      setStatus("Ready");
    }

    // -----------------------
    // Buttons (the main fix)
    // -----------------------
    if (inspectBtn){
      inspectBtn.onclick = () => {
        // Create a demo inspection request
        const when = prompt("【Demo】你希望看房时间？（例如：本周六 2pm / 下周二上午）");
        state.lead.inspection = when ? when : "已提交（待确认时间）";
        add("assistant",
          "【Demo】已生成预约看房请求 ✅\n" +
          "下一步：顾问将确认时间并发送地址/注意事项。"
        );
        renderLead();
      };
    }

    if (contactBtn){
      contactBtn.onclick = () => {
        const contact = prompt("【Demo】请输入联系方式（微信 / 手机 / 邮箱）：");
        if (!contact){
          add("assistant", "【Demo】未输入联系方式。我可以先继续给你建议，或你稍后再点击「留下联系方式」。");
          return;
        }
        state.lead.contact = contact;
        add("assistant",
          "【Demo】联系方式已记录 ✅\n" +
          "我已把你的需求整理成线索，将交给顾问跟进。"
        );
        renderLead();
      };
    }

    // chips
    document.querySelectorAll(".chip").forEach(el=>{
      el.addEventListener("click", ()=>{
        inp.value = el.getAttribute("data-fill") || "";
        inp.focus();
      });
    });

    // events
    btn.addEventListener("click", send);
    inp.addEventListener("keydown", (e)=>{ if(e.key==="Enter") send(); });

    // welcome
    add("assistant",
      "你好！我是 LeaseMind（V2 Demo，本地模拟）。\n" +
      "我会用 ≤3 个补问把你的租房需求变成“可执行决策”，并引导到预约看房或留资。\n\n" +
      "你可以直接说：预算/房型/入住时间/离 Monash Clayton 多近。"
    );
    setStatus("Ready");
  </script>
</body>
</html>
