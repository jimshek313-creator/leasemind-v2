<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LeaseMind V2 Demo</title>
    <style>
      body { font-family: Arial, sans-serif; max-width: 860px; margin: 24px auto; padding: 0 12px; }
      .box { border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
      .msg { padding: 10px 12px; border: 1px solid #eee; border-radius: 12px; margin: 8px 0; white-space: pre-wrap; }
      .user { text-align: right; background: #fafafa; }
      .assistant { text-align: left; }
      .row { display: flex; gap: 8px; margin-top: 12px; }
      input { flex: 1; padding: 10px 12px; border-radius: 10px; border: 1px solid #ddd; }
      button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ddd; background: white; cursor: pointer; }
      button:disabled { opacity: .6; cursor: not-allowed; }
      .hint { font-size: 13px; opacity: .7; margin-top: 8px; }
    </style>
  </head>
  <body>
    <h1>LeaseMind V2（Monash Clayton 租房 AI 客服）</h1>
    <p class="hint">超简化版：网页 → /api/chat → OpenAI → 返回文字</p>

    <div class="box" id="chat"></div>

    <div class="row">
      <input id="inp" placeholder="例如：单人间，$280–$320/周，下周入住…" />
      <button id="btn">发送</button>
    </div>

    <script>
      const chat = document.getElementById("chat");
      const inp = document.getElementById("inp");
      const btn = document.getElementById("btn");

      function add(role, text) {
        const div = document.createElement("div");
        div.className = "msg " + (role === "user" ? "user" : "assistant");
        div.textContent = text;
        chat.appendChild(div);
        window.scrollTo(0, document.body.scrollHeight);
      }

      add("assistant", "你好！我是 LeaseMind（V2 Demo）。告诉我预算、房型、入住时间，我帮你筛选并指导下一步。");

      async function send() {
        const text = inp.value.trim();
        if (!text) return;
        inp.value = "";
        btn.disabled = true;
        add("user", text);

        try {
          const r = await fetch("/api/chat", {
            method: "POST",
            headers: { "content-type": "application/json" },
            body: JSON.stringify({ message: text })
          });
          const j = await r.json();
          if (!j.ok) throw new Error(j.error || "API error");
          add("assistant", j.reply);
        } catch (e) {
          add("assistant", "出错了：" + (e.message || e));
        } finally {
          btn.disabled = false;
          inp.focus();
        }
      }

      btn.onclick = send;
      inp.addEventListener("keydown", (e) => { if (e.key === "Enter") send(); });
    </script>
  </body>
</html>
